#!/bin/bash
# å…¨å±€ Git Commit-msg Hook
# åŠŸèƒ½ï¼šè§„èŒƒ commit message æ ¼å¼

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# è·³è¿‡ merge commit
if echo "$COMMIT_MSG" | grep -q "^Merge"; then
  exit 0
fi

# æ£€æŸ¥æ˜¯å¦ä¸ºç©º
if [ -z "$(echo "$COMMIT_MSG" | tr -d '[:space:]')" ]; then
  echo "âŒ é”™è¯¯ï¼šcommit message ä¸èƒ½ä¸ºç©º"
  exit 1
fi

# æ£€æŸ¥æœ€å°é•¿åº¦ï¼ˆè‡³å°‘ 5 ä¸ªå­—ç¬¦ï¼‰
if [ ${#COMMIT_MSG} -lt 5 ]; then
  echo "âŒ é”™è¯¯ï¼šcommit message å¤ªçŸ­ï¼Œè‡³å°‘éœ€è¦ 5 ä¸ªå­—ç¬¦"
  echo "   å½“å‰ï¼š$COMMIT_MSG"
  exit 1
fi

# å»ºè®®æ ¼å¼ï¼ˆä¸å¼ºåˆ¶ï¼‰
if ! echo "$COMMIT_MSG" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|build|ci|revert):|^[A-Z]|^[a-z]+:"; then
  echo "ğŸ’¡ æç¤ºï¼šå»ºè®®ä½¿ç”¨è§„èŒƒçš„ commit message æ ¼å¼"
  echo "   ä¾‹å¦‚ï¼šfeat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
  echo "   æˆ–è€…ï¼šä¿®å¤ç™»å½•é¡µé¢æ ·å¼é—®é¢˜"
  echo "   å½“å‰ï¼š$COMMIT_MSG"
  echo ""
fi

exit 0
